<!DOCTYPE html>
<meta charset="utf-8">
<style>
    #trend-graph {
        font-family: Arial, sans-serif;
        font-size: 13px;
    }

    .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 3px;
    }

    path+.node circle {
        fill: #ffc3c3 !important;
        stroke: red;
        stroke-width: 3px;
    }

    .node text {
        font: 12px sans-serif;
    }

    .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 2px;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #b6b6b6;
        shape-rendering: crispEdges;
    }
</style>

<body>
    <div style="text-align: center">
        <div id="trend-graph"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script>
        var data = {
            "data": [{
                    "articles": [
                        [1999, 4],
                        [2000, 17],
                        [2001, 9],
                        [2002, 15],
                        [2003, 17],
                        [2004, 66],
                        [2005, 84],
                        [2006, 105],
                        [2007, 106],
                        [2008, 88],
                        [2009, 105],
                        [2010, 88],
                        [2011, 154],
                        [2012, 274],
                        [2013, 297],
                        [2014, 224],
                        [2015, 164],
                        [2016, 11]
                    ],
                    "total": 1828,
                    "name": "Not specified"
                }, {
                    "articles": [
                        [1997, 1],
                        [1998, 1],
                        [2001, 1],
                        [2002, 2],
                        [2003, 8],
                        [2004, 25],
                        [2005, 29],
                        [2006, 45],
                        [2007, 41],
                        [2008, 29],
                        [2009, 33],
                        [2010, 27],
                        [2011, 36],
                        [2012, 50],
                        [2013, 62],
                        [2014, 56],
                        [2015, 46],
                        [2016, 1]
                    ],
                    "total": 493,
                    "name": "Multiple"
                }, {
                    "articles": [
                        [1997, 1],
                        [1998, 1],
                        [1999, 3],
                        [2000, 9],
                        [2001, 3],
                        [2002, 8],
                        [2003, 25],
                        [2004, 38],
                        [2005, 59],
                        [2006, 59],
                        [2007, 50],
                        [2008, 35],
                        [2009, 25],
                        [2010, 22],
                        [2011, 30],
                        [2012, 34],
                        [2013, 60],
                        [2014, 67],
                        [2015, 79],
                        [2016, 5]
                    ],
                    "total": 613,
                    "name": "Single"
                }, {
                    "articles": [
                        [1998, 1],
                        [2003, 1],
                        [2004, 3],
                        [2005, 5],
                        [2006, 7],
                        [2007, 11],
                        [2008, 1],
                        [2009, 7],
                        [2010, 4],
                        [2011, 7],
                        [2012, 6],
                        [2013, 13],
                        [2014, 5],
                        [2015, 3],
                        [2016, 1]
                    ],
                    "total": 75,
                    "name": "Dual"
                }, {
                    "articles": [
                        [1999, 4],
                        [2000, 17],
                        [2001, 9],
                        [2002, 15],
                        [2003, 17],
                        [2004, 66],
                        [2005, 84],
                        [2006, 105],
                        [2007, 106],
                        [2008, 88],
                        [2009, 105],
                        [2010, 88],
                        [2011, 154],
                        [2012, 274],
                        [2013, 297],
                        [2014, 224],
                        [2015, 164],
                        [2016, 11]
                    ],
                    "total": 1828,
                    "name": "specified"
                }, {
                    "articles": [
                        [1997, 1],
                        [1998, 1],
                        [2001, 1],
                        [2002, 2],
                        [2003, 8],
                        [2004, 25],
                        [2005, 29],
                        [2006, 45],
                        [2007, 41],
                        [2008, 29],
                        [2009, 33],
                        [2010, 27],
                        [2011, 36],
                        [2012, 50],
                        [2013, 62],
                        [2014, 56],
                        [2015, 46],
                        [2016, 1]
                    ],
                    "total": 493,
                    "name": "hybrid"
                }, {
                    "articles": [
                        [1997, 1],
                        [1998, 1],
                        [1999, 3],
                        [2000, 9],
                        [2001, 3],
                        [2002, 8],
                        [2003, 25],
                        [2004, 38],
                        [2005, 59],
                        [2006, 59],
                        [2007, 50],
                        [2008, 35],
                        [2009, 25],
                        [2010, 22],
                        [2011, 30],
                        [2012, 34],
                        [2013, 60],
                        [2014, 67],
                        [2015, 79],
                        [2016, 5]
                    ],
                    "total": 613,
                    "name": "tripple"
                }, {
                    "articles": [
                        [1998, 1],
                        [2003, 1],
                        [2004, 3],
                        [2005, 5],
                        [2006, 7],
                        [2007, 11],
                        [2008, 1],
                        [2009, 7],
                        [2010, 4],
                        [2011, 7],
                        [2012, 6],
                        [2013, 13],
                        [2014, 5],
                        [2015, 3],
                        [2016, 1]
                    ],
                    "total": 75,
                    "name": "octal"
                }


            ],
            "yearRange": {
                "start_year": 1988,
                "end_year": 2016
            }
        };

        function truncate(str, maxLength, suffix) {
            if (str.length > maxLength) {
                str = str.substring(0, maxLength + 1);
                str = str.substring(0, Math.min(str.length, str.lastIndexOf(" ")));
                str = str + suffix;
            }
            return str;
        }

        var margin = {
                top: 50,
                right: 0,
                bottom: 0,
                left: 20
            },
            width = 700 - margin.right - margin.left,
            height = 300 - margin.top - margin.bottom;


        var c = d3.scale.category10();

        var x = d3.scale.linear()
            .range([0, width]);

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("top");

        var formatYears = d3.format("0000");
        xAxis.tickFormat(formatYears);
        var svg;


        svg = d3.select("#trend-graph").append("svg")
            .attr("width", width + margin.left + margin.right + 200)
            .attr("height", height + margin.top + margin.bottom)
            .style("margin-left", margin.left + "px")
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .style("width", width + margin.left + margin.right);

        var start_year = data.yearRange['start_year'];
        var end_year = data.yearRange['end_year'];
        x.domain([start_year, end_year]);
        var xScale = d3.scale.linear()
            .domain([start_year, end_year])
            .range([0, width]);

        svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + 0 + ")")
            .call(xAxis);

        for (var j = 0; j < data.data.length; j++) {
            var g = svg.append("g").attr("class", "journal");

            var circles = g.selectAll("circle")
                .data(data.data[j]['articles'])
                .enter()
                .append("circle");

            var text = g.selectAll("text")
                .data(data.data[j]['articles'])
                .enter()
                .append("text");

            var rScale = d3.scale.linear()
                .domain([0, d3.max(data.data[j]['articles'], function (d) {
                    return d[1];
                })])
                .range([2, 9]);

            circles
                .attr("cx", function (d, i) {
                    return xScale(d[0]);
                })
                .attr("cy", j * 30 + 20)
                .attr("r", function (d) {
                    return rScale(d[1]);
                })
                .style("fill", function (d) {
                    return c(j);
                });

            text
                .attr("y", j * 30 + 25)
                .attr("x", function (d, i) {
                    return xScale(d[0]) - 5;
                })
                .attr("class", "value")
                .text(function (d) {
                    return d[1];
                })
                .style("fill", function (d) {
                    return c(j);
                })
                .style("display", "none");

            g.append("text")
                .attr("y", j * 30 + 25)
                .attr("x", width + 20)
                .attr("class", "label")
                .attr("data-label", data.data[j]['name'])
                .attr('title', data.data[j]['total'])
                .text(truncate(data.data[j]['name'], 60, "..."))
                .style("fill", function (d) {
                    return c(j);
                })
                .on("mouseover", mouseover)
                .on("mouseout", mouseout);
        }


        function mouseover(p) {

            var g = d3.select(this).node().parentNode;
            var title = 'Total frequency for ' + d3.select(g).selectAll("text.label").attr('data-label') +
                ' : ' + d3.select(g).selectAll("text.label").attr('title');
            d3.select(g).selectAll("circle").style("display", "none");
            d3.select(g).selectAll("text.label").append('title').text(title);
            d3.select(g).selectAll("text.value").style("display", "block");
        }

        function mouseout(p) {
            var g = d3.select(this).node().parentNode;
            d3.select(g).selectAll("text.label title").remove();
            d3.select(g).selectAll("circle").style("display", "block");
            d3.select(g).selectAll("text.value").style("display", "none");
        }
    </script>