/*! d3.chart.bubble-matrix v0.1.5 - MIT Expat */
!function(a){return"object"==typeof exports&&"object"==typeof module?(module.exports=a(require("d3"),require("d3.chart"),require("d3.chart.base"),require("lodash")),void 0):"function"==typeof define&&define.amd?define(["d3","d3.chart","d3.chart.base","lodash"],a):(this.d3ChartBubbleMatrix=a(this.d3,this.d3Chart,this.d3ChartBase,this._),void 0)}(function(a,b,c,d){"use strict";var e={};return function(){e.makeProp=function(a,b){return function(c){return null==c?this[a]:(this[a]=c,null!=b&&b.call(this,c),this)}},e.textRuler=function(a){var b,c;return b=function(b,c){var d,e;return d=a.append("text").text(b),e=c(d),d.remove(),e},c=d.memoize(function(a){return b(a,function(a){return a.node().getComputedTextLength()})}),c.extentOfChar=d.memoize(function(a){if(a.length<1)throw new Error("char can't be empty");if(a.length>1)throw new Error("can get extent of a full string");return b(a,function(a){return a.node().getExtentOfChar(0)})}),c.onTmpText=b,c},e.layers={}}.call(this),function(){var a,b,c,d,f,g,h;g={events:{}},a=.15,g.dataBind=function(a){var b;return b=this.chart(),b.bubbleKey_=b.colKey_?function(c,d){return b.colKey_(a.cols[d],d)}:void 0,this.selectAll("g.row").data(a.rows,b.rowKey_)},g.insert=function(){var a;return a=this.chart(),this.append("g").classed("row",!0)},b=function(a,b){return this.attr("r",0),this.attr("fill",function(a){return b.colorScale_(b.color_(a))}),this.attr("opacity",0),this.attr("cx",function(a,c){return b.xScale_(c)})},d=function(b,c){return this.attr("stroke-width",a*c.maxRadius_)},c=function(){return this.remove()},f=function(a,b){return this.duration(b.duration_),this.attr("opacity",1),this.attr("cx",function(a,c){return b.xScale_(c)}),this.attr("r",function(a){return b.radiusScale_(b.size_(a))}),this.attr("fill",function(a){return b.colorScale_(b.color_(a))})},h=function(a,b){return this.attr("transform",function(a,c){return"translate(0,"+b.yScale_(c)+")"})},g.events.enter=function(){var a;return a=this.chart(),this.call(h,a)},g.events.merge=function(){var a,e,g;return e=this.chart(),null!=e.bubbleKey_&&(g=function(){return this instanceof Array?e.bubbleKey_.apply(this,arguments):this.__key__}),a=this.selectAll("circle").data(e.rowData_,g),a.enter().append("circle").call(b,e),a.exit().call(c,e),a.call(d,e),null!=g&&a.each(function(a,b){return this.__key__=e.bubbleKey_(a,b)}),a.transition().call(f,e)},g.events["update:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.call(h,a)},g.events.exit=function(){return this.remove()},e.layers.bubble=g}.call(this),function(){var a,b;a={events:{}},a.dataBind=function(a){var b;return b=this.chart(),this.selectAll("text").data(a.cols,b.colKey_)},a.insert=function(){var a;return a=this.chart(),this.append("text").attr("opacity",0)},b=function(a,b){var c,d;return c=b.bottomMargin_,d=b.slanted_,this.attr("transform",function(a,e){var f;return f="translate("+b.xScale_(e)+","+c+")",d&&(f+="rotate(45)"),f})},a.events.enter=function(){return this.call(b,this.chart())},a.events.merge=function(){var a;return a=this.chart(),this.text(a.colHeader_)},a.events["enter:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",1)},a.events["update:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.call(b,a),this.attr("opacity",1)},a.events.exit=function(){return this.remove()},e.layers["col-header"]=a}.call(this),function(){var a,b;a={events:{}},a.dataBind=function(a){var b;return b=this.chart(),this.selectAll("text").data(a.rows,b.rowKey_)},a.insert=function(){var a;return a=this.chart(),this.append("text").attr("opacity",0).attr("dy","0.38em")},b=function(a,b){var c,d;return d=b.width(),c=b.rowHeaderLeft_,this.attr("transform",function(a,d){return"translate("+c+","+b.yScale_(d)+")"})},a.events.enter=function(){var a;return a=this.chart(),this.call(b,a)},a.events.merge=function(){var a;return a=this.chart(),this.text(function(){return a.rowHeader_.apply(this,arguments)})},a.events["enter:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",1)},a.events["update:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.call(b,a),this.attr("opacity",1)},a.events["exit:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",0).remove()},e.layers["row-header"]=a}.call(this),function(){var a,b,c;b={events:{}},a=1,b.dataBind=function(a){var b;return b=this.chart(),this.selectAll("g.thread").data(a.rows,b.rowKey_)},b.insert=function(){var a,b;return a=this.chart(),b=this.append("g").classed("thread",!0).attr("opacity",0),b.append("path"),b},c=function(a,b){return this.attr("transform",function(a,c){return"translate(0,"+b.yScale_(c)+")"})},b.events.enter=function(){return this.call(c,this.chart())},b.events.merge=function(){var b,c,d,e,f;return b=this.chart(),e=b.xScale_.range(),c=b.leftMargin_,f=a*b.maxRadius_,d="M "+c+" -"+f/2+" v "+f,d+="M "+c+" 0 H "+e[e.length-1],this.select("path").attr("d",d)},b.events["enter:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",1)},b.events["update:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.call(c,a),this.attr("opacity",1)},b.events["exit:transition"]=function(){var a;return a=this.chart(),this.duration(a.duration_),this.attr("opacity",0).remove()},e.layers.thread=b}.call(this),function(){var b,c,f,g,h,i,j,k;k=e.makeProp,c="BubbleMatrix",b="d3-chart-bubble-matrix",g=1,i=1,h=.1,f=["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],j=function(){return a.scale.quantize().domain([0,1]).range(f)},e.Chart=a.chart("BaseChart").extend(c,{initialize:function(){var c,d,f,g,h,i;for(this.loadDefaults_(),this.base.classed(b,!0),this.xScale_=a.scale.ordinal(),this.yScale_=a.scale.ordinal(),this.radiusScale_=a.scale.sqrt(),this.leftMargin_=0,h=["thread","bubble","row-header","col-header"],i=[],f=0,g=h.length;g>f;f++)d=h[f],c=this.base.append("g").classed(d,!0),i.push(this.layer(d,c,e.layers[d]));return i},loadDefaults_:function(){return this.rows_||this.rows(function(a){return a.rows}),this.rowHeader_||this.rowHeader(function(a){return a.name}),this.rowData_||this.rowData(function(a){return a.values}),this.column_||this.columns(function(a){return a.columns}),this.colHeader_||this.colHeader(function(a){return a}),this.size_||this.size(function(a){return a[0]}),this.color_||this.color(function(a){return a[1]}),this.colorScale_||this.colorScale(j()),this.slanted_||this.slanted(!1),this.duration_||this.duration(250)},transform:function(b){var c,d,f,j,k,l,m,n,o;return this.ruler_=e.textRuler(this.base),m=this.rows_(b),d=this.columns_(b),j=this.updateLeftMargin_(m,this.width()),c=this.getMaxBottom_(d,this.height()),n=(this.width()-j)/d.length,o=(c-0)/m.length,this.xScale_.domain(a.range(0,d.length)),this.yScale_.domain(a.range(0,m.length)),f=Math.min(n,o),l=j+f*d.length,c=f*m.length,this.xScale_.rangePoints([j,l],g),this.yScale_.rangePoints([0,c],i),k=this.ruler_.extentOfChar("W").height,this.bottomMargin_=c+1.3*k,f=this.xScale_(1)-this.xScale_(0),this.maxRadius_=f*(1-h)/2,this.radiusScale_.range([0,this.maxRadius_]),{rows:m,cols:d}},updateLeftMargin_:function(a){var b,c,e,f=this;return b=this.leftMargin_,c=function(a,b,c){return Math.max(a,f.ruler_(f.rowHeader_(b,c)))},this.rowHeaderLeft_=d.reduce(a,c,0),e=this.ruler_.extentOfChar("W").width,this.rowHeaderLeft_+=e,this.leftMargin_=this.rowHeaderLeft_+e,this.leftMargin_!==b&&this.trigger("margin",this.leftMargin_),this.leftMargin_+this.ruler_.extentOfChar("W").width},getMaxBottom_:function(a,b){return b-2*this.ruler_.extentOfChar("W").height},rows:k("rows_"),rowHeader:k("rowHeader_"),rowKey:k("rowKey_"),rowData:k("rowData_"),columns:k("columns_"),colHeader:k("colHeader_"),colKey:k("colKey_"),size:k("size_"),color:k("color_"),sizeDomain:k("sizeDomain_",function(a){return this.radiusScale_.domain(a)}),colorScale:k("colorScale_"),slanted:k("slanted_"),duration:k("duration_")})}.call(this),e});